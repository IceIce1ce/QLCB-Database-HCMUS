-- MSSV: 18127070
-- Họ tên: Trần Đại Chí
-- Lớp: 18CLC3
-- Email: 18127070@student.hcmus.edu.vn
-- Ngày làm bài: 6/7/2020
-- CREATE DATABASE
CREATE DATABASE VP18_QLCB2K19_18127070
GO
USE VP18_QLCB2K19_18127070

--CREATE TABLE + PRIMARY KEY
GO
CREATE TABLE KHACHHANG
(
	MAKH CHAR(15),
	TEN VARCHAR(15),
	DCHI VARCHAR(50),
	DTHOAI CHAR(12),
	CONSTRAINT PK_KHACHHANG
	PRIMARY KEY(MAKH)
)

GO
CREATE TABLE NHANVIEN
(
	MANV CHAR(15),
	TEN VARCHAR(15),
	DCHI VARCHAR(50),
	DTHOAI CHAR(12),
	LUONG DECIMAL(10, 2),
	LOAINV BIT CHECK (LOAINV IN (0, 1)),
	CONSTRAINT PK_NHANVIEN
	PRIMARY KEY(MaNV)
)

GO 
CREATE TABLE LOAIMB
(
	HANGSX VARCHAR(15),
	MALOAI CHAR(15),
	CONSTRAINT PK_LOAIMB
	PRIMARY KEY(MALOAI)
)

GO
CREATE TABLE MAYBAY
(
	SOHIEU INT,
	MALOAI CHAR(15),
	CONSTRAINT PK_MAYBAY
	PRIMARY KEY(SOHIEU, MALOAI)
)

GO
CREATE TABLE CHUYENBAY
(
	MACB CHAR(4),
	SBDI CHAR(3),
	SBDEN CHAR(3),
	GIODI TIME(6),
	GIODEN TIME(6),
	CONSTRAINT PK_CHUYENBAY
	PRIMARY KEY(MACB)
)

GO
CREATE TABLE LICHBAY
(
	NGAYDI DATE,
	MACB CHAR(4),
	SOHIEU INT,
	MALOAI CHAR(15),
	CONSTRAINT PK_LICHBAY
	PRIMARY KEY(NGAYDI, MACB)
)

GO
CREATE TABLE DATCHO
(
	MAKH CHAR(15),
	NGAYDI DATE, 
	MACB CHAR(4),
	CONSTRAINT PK_DATCHO
	PRIMARY KEY(MAKH, NGAYDI, MACB)
)

GO
CREATE TABLE KHANANG
(
	MANV CHAR(15),
	MALOAI CHAR(15),
	CONSTRAINT PK_KHANANG
	PRIMARY KEY(MANV, MALOAI)
)

GO
CREATE TABLE PHANCONG
(
	MANV CHAR(15),
	NGAYDI DATE,
	MACB CHAR(4),
	CONSTRAINT PK_PHANCONG
	PRIMARY KEY(MANV, NGAYDI, MACB)
)

-- CREATE FOREIGN KEY
ALTER TABLE DATCHO
ADD CONSTRAINT FK_DATCHO_KHACHHANG
FOREIGN KEY(MAKH)
REFERENCES KHACHHANG(MAKH)

ALTER TABLE DATCHO
ADD CONSTRAINT FK_DATCHO_LICHBAY
FOREIGN KEY(NGAYDI, MACB)
REFERENCES LICHBAY(NGAYDI, MACB)

ALTER TABLE LICHBAY
ADD CONSTRAINT FK_LICHBAY_CHUYENBAY
FOREIGN KEY(MACB)
REFERENCES CHUYENBAY(MACB)

ALTER TABLE LICHBAY
ADD CONSTRAINT FK_LICHBAY_MAYBAY
FOREIGN KEY(SOHIEU, MALOAI)
REFERENCES MAYBAY(SOHIEU, MALOAI)

ALTER TABLE MAYBAY
ADD CONSTRAINT FK_MAYBAY_LOAIMB
FOREIGN KEY(MALOAI)
REFERENCES LOAIMB(MALOAI)

ALTER TABLE KHANANG
ADD CONSTRAINT FK_KHANANG_LOAIMB
FOREIGN KEY(MALOAI)
REFERENCES LOAIMB(MALOAI)

ALTER TABLE KHANANG
ADD CONSTRAINT FK_KHANANG_NHANVIEN
FOREIGN KEY(MANV)
REFERENCES NHANVIEN(MaNV)

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PHANCONG_LICHBAY
FOREIGN KEY(NGAYDI, MACB)
REFERENCES LICHBAY(NGAYDI, MACB)

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PHANCONG_NHANVIEN
FOREIGN KEY(MANV)
REFERENCES NHANVIEN(MANV)

-- INPUT DATA TO TABLE
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0009', 'Nga', '223 Nguyen Trai', '8932320')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0101', 'Anh', '567 Tran Phu', '8826729')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0045', 'Thu', '285 Le Loi', '8932203')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0012', 'Ha', '435 Quang Trung', '8933232')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0238', 'Hung', '456 Pasteur', '9812101')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0397', 'Thanh', '234 Le Van Si', '8952943')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0582', 'Mai', '789 Nguyen Du', NULL)
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0934', 'Minh', '678 Le Lai', NULL)
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0091', 'Hai', '345 Hung Vuong', '8893223')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0314', 'Phuong', '395 Vo Van Tan', '8232320')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0613', 'Vu', '348 CMT8', '8343232')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0586', 'Son', '123 Bach Dang', '8556223')
INSERT INTO KHACHHANG(MAKH, TEN, DCHI, DTHOAI)
	VALUES ('0422', 'Tien', '75 Nguyen Thong', '8332222')

INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('100', 'SLC', 'BOS', '08:00', '17:50')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('112', 'DCA', 'DEN', '14:00', '18:07')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('121', 'STL', 'SLC', '07:00', '09:13')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('122', 'STL', 'YYV', '08:30', '10:19')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('206', 'DFW', 'STL', '09:00', '11:40')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('330', 'JFK', 'YYV', '16:00', '18:53')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('334', 'ORD', 'MIA', '12:00', '14:14')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('335', 'MIA', 'ORD', '15:00', '17:14')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('336', 'ORD', 'MIA', '18:00', '20:14')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('337', 'MIA', 'ORD', '20:30', '23:53')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('394', 'DFW', 'MIA', '19:00', '21:30')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('395', 'MIA', 'DFW', '21:00', '23:43')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('449', 'CDG', 'DEN', '10:00', '19:29')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('930', 'YYV', 'DCA', '13:00', '16:10')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('931', 'DCA', 'YYV', '17:00', '18:10')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('932', 'DCA', 'YYV', '18:00', '19:10')
INSERT INTO CHUYENBAY(MACB, SBDI, SBDEN, GIODI, GIODEN)
	VALUES ('991', 'BOS', 'ORD', '17:00', '18:22')

INSERT INTO NHANVIEN(MANV, TEN, DCHI, DTHOAI, LUONG, LOAINV)
	VALUES ('1006', 'Chi', '12/6 Nguyen Kiem', '8120012', 150000, 0)
INSERT INTO NHANVIEN(MANV, TEN, DCHI, DTHOAI, LUONG, LOAINV)
	VALUES ('1005', 'Giao', '65 Nguyen Thai Son', '8324467', 500000, 0)
INSERT INTO NHANVIEN(MANV, TEN, DCHI, DTHOAI, LUONG, LOAINV)
	VALUES ('1001', 'Huong', '8 Dien Bien Phu', '8330733', 500000, 1)
INSERT INTO NHANVIEN(MANV, TEN, DCHI, DTHOAI, LUONG, LOAINV)
	VALUES ('1002', 'Phong', '1 Ly Thuong Kiet', '8308117', 450000, 1)
INSERT INTO NHANVIEN(MANV, TEN, DCHI, DTHOAI, LUONG, LOAINV)
	VALUES ('1004', 'Phuong', '351 Lac Long Quan', '8308155', 250000, 0)
INSERT INTO NHANVIEN(MANV, TEN, DCHI, DTHOAI, LUONG, LOAINV)
	VALUES ('1003', 'Quang', '78 Truong Dinh', '8324461', 350000, 1)
INSERT INTO NHANVIEN(MANV, TEN, DCHI, DTHOAI, LUONG, LOAINV)
	VALUES ('1007', 'Tam', '36 Nguyen Van Cu', '8458188', 500000, 0)

INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('Airbus', 'A310')
INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('Airbus', 'A320')
INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('Airbus', 'A330')
INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('Airbus', 'A340')
INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('Boeing', 'B727')
INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('Boeing', 'B747')
INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('Boeing', 'B757')
INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('MD', 'DC10')
INSERT INTO LOAIMB(HANGSX, MALOAI) VALUES ('MD', 'DC9')

INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (10, 'B747')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (11, 'B727')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (13, 'B727')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (13, 'B747')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (21, 'DC10')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (21, 'DC9')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (22, 'B757')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (22, 'DC9')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (23, 'DC9')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (24, 'DC9')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (70, 'A310')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (80, 'A310')
INSERT INTO MAYBAY(SOHIEU, MALOAI)	VALUES (93, 'B757')

INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1001', 'B727')
INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1001', 'B747')
INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1001', 'DC10')
INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1002', 'A320')
INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1002', 'A340')
INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1002', 'B757')
INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1002', 'DC9')
INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1003', 'A310')
INSERT INTO KHANANG(MANV, MALOAI) VALUES ('1003', 'DC9')

INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('11/01/2000', '100', 80, 'A310')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('11/01/2000', '112', 21, 'DC10')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('11/01/2000', '206', 22, 'DC9')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('11/01/2000', '334', 10, 'B747')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('11/01/2000', '395', 23, 'DC9')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('11/01/2000', '991', 22, 'B757')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('11/01/2000', '337', 10, 'B747')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('10/31/2000', '100', 11, 'B727')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('10/31/2000', '112', 11, 'B727')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('10/31/2000', '206', 13, 'B727')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('10/31/2000', '334', 10, 'B747')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('10/31/2000', '335', 10, 'B747')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('10/31/2000', '337', 24, 'DC9')
INSERT INTO LICHBAY(NGAYDI, MACB, SOHIEU, MALOAI) VALUES ('10/31/2000', '449', 70, 'A310')

INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1001', '11/01/2000', '100')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1001', '10/31/2000', '100')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1002', '11/01/2000', '100')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1002', '10/31/2000', '100')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1003', '10/31/2000', '100')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1003', '10/31/2000', '337')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1004', '10/31/2000', '100')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1004', '10/31/2000', '337')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1005', '10/31/2000', '337')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1006', '11/01/2000', '991')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1006', '10/31/2000', '337')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1007', '11/01/2000', '112')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1007', '11/01/2000', '991')
INSERT INTO PHANCONG(MANV, NGAYDI, MACB) VALUES ('1007', '10/31/2000', '206')

INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0009', '11/01/2000', '100')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0009', '10/31/2000', '449')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0045', '11/01/2000', '991')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0012', '10/31/2000', '206')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0238', '10/31/2000', '334')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0582', '11/01/2000', '991')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0091', '11/01/2000', '100')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0314', '10/31/2000', '449')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0613', '11/01/2000', '100')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0586', '11/01/2000', '991')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0586', '10/31/2000', '100')
INSERT INTO DATCHO(MAKH, NGAYDI, MACB) VALUES ('0422', '10/31/2000', '449')

-- TEST DATABASE
SELECT * FROM dbo.CHUYENBAY
SELECT * FROM dbo.DATCHO
SELECT * FROM dbo.KHACHHANG
SELECT * FROM dbo.KHANANG
SELECT * FROM dbo.LICHBAY
SELECT * FROM dbo.LOAIMB
SELECT * FROM dbo.MAYBAY
SELECT * FROM dbo.NHANVIEN 
SELECT * FROM dbo.PHANCONG

-- Q1
SELECT NV.MANV, NV.TEN, NV.DCHI, NV.DTHOAI
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC, dbo.LICHBAY LB WHERE NV.MANV = PC.MANV AND PC.MACB = LB.MACB AND LB.MALOAI = 'B747'
-- Q2
SELECT CB.MACB, LB.NGAYDI
FROM dbo.CHUYENBAY CB, dbo.LICHBAY LB 
WHERE LB.MACB = CB.MACB AND CB.SBDI = 'DCA' AND DATEDIFF(MINUTE, CB.GIODI, '14:00') <= 0 AND DATEDIFF(MINUTE, CB.GIODI, '18:00') >= 0
-- Q3
SELECT DISTINCT NV.TEN
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC, dbo.CHUYENBAY CB WHERE NV.MANV = PC.MANV AND PC.MACB = '100' AND PC.MACB = CB.MACB AND CB.SBDI = 'SLC'
-- Q4
SELECT DISTINCT LB.SOHIEU, LB.MALOAI
FROM dbo.LICHBAY LB, dbo.CHUYENBAY CB WHERE LB.MACB = CB.MACB AND CB.SBDI = 'MIA'
-- Q5
SELECT DC.MACB, DC.NGAYDI, KH.TEN, KH.DCHI, KH.DTHOAI
FROM dbo.KHACHHANG KH, dbo.DATCHO DC WHERE KH.MAKH = DC.MAKH
ORDER BY DC.MACB ASC, DC.NGAYDI DESC
-- Q6
SELECT PC.MACB, PC.NGAYDI, NV.TEN, NV.DCHI, NV.DTHOAI
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV
ORDER BY PC.MACB ASC, PC.NGAYDI DESC
-- Q7
SELECT PC.MACB, PC.NGAYDI, NV.MANV, NV.TEN
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC, dbo.CHUYENBAY CB WHERE NV.MANV = PC.MANV AND PC.MACB = CB.MACB AND NV.LOAINV = 1 AND CB.SBDEN = 'ORD'
-- Q8
SELECT PC.MACB, PC.NGAYDI, NV.TEN
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV AND NV.LOAINV = 1 AND PC.MANV = '1001'
-- Q9
SELECT CB.MACB, CB.SBDI, CB.GIODI, CB.GIODEN, LB.NGAYDI
FROM dbo.LICHBAY LB, dbo.CHUYENBAY CB WHERE LB.MACB = CB.MACB AND CB.SBDEN = 'DEN' 
ORDER BY LB.NGAYDI DESC, CB.SBDI ASC
-- Q10
SELECT NV.TEN, LM.HANGSX, LM.MALOAI
FROM dbo.NHANVIEN NV, dbo.KHANANG KN, dbo.LOAIMB LM WHERE NV.MANV = KN.MANV AND KN.MALOAI = LM.MALOAI AND NV.LOAINV = 1
-- Q11
SELECT NV.MANV, NV.TEN
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV AND NV.LOAINV = 1 AND PC.MACB = '100' AND DATEDIFF(DAY, PC.NGAYDI, '11/01/2000') = 0
-- Q12
SELECT PC.MACB, NV.MANV, NV.TEN
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC, dbo.CHUYENBAY CB 
WHERE NV.MANV = PC.MANV AND PC.MACB = CB.MACB AND DATEDIFF(DAY, PC.NGAYDI, '10/31/2000') = 0 AND CB.SBDI = 'MIA' AND DATEDIFF(MINUTE, CB.GIODI, '20:30') = 0
-- Q13
SELECT PC.MACB, LB.SOHIEU, LB.MALOAI, LM.HANGSX
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC, dbo.LICHBAY LB, dbo.LOAIMB LM 
WHERE NV.MANV = PC.MANV AND PC.MACB = LB.MACB AND LB.MALOAI = LM.MALOAI AND NV.LOAINV = 1 AND NV.TEN = 'Quang' AND DATEDIFF(DAY, PC.NGAYDI, LB.NGAYDI) = 0
-- Q14
SELECT NV.TEN
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.LOAINV = 1 AND NV.MANV NOT IN (SELECT PC.MANV FROM dbo.PHANCONG PC) 
-- Q15
SELECT DISTINCT KH.TEN
FROM dbo.KHACHHANG KH, dbo.DATCHO DC, dbo.LICHBAY LB, dbo.LOAIMB LM 
WHERE KH.MAKH = DC.MAKH AND DC.MACB = LB.MACB AND LB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Boeing' AND DATEDIFF(DAY, LB.NGAYDI, DC.NGAYDI) = 0
-- Q16
SELECT DISTINCT LB.MACB
FROM dbo.LICHBAY LB, dbo.MAYBAY MB, dbo.LOAIMB LM
WHERE LB.MALOAI = MB.MALOAI AND MB.MALOAI = LM.MALOAI AND MB.SOHIEU = 10 AND LM.MALOAI = 'B747'
-- Q17
SELECT CB.SBDEN, COUNT(LB.NGAYDI) AS SOLUONGHACANH
FROM dbo.LICHBAY LB, dbo.CHUYENBAY CB WHERE LB.MACB = CB.MACB GROUP BY CB.SBDEN
ORDER BY CB.SBDEN ASC
-- Q18
SELECT CB.SBDI, COUNT(LB.NGAYDI) AS SOLUONGXUATPHAT
FROM dbo.LICHBAY LB, dbo.CHUYENBAY CB WHERE LB.MACB = CB.MACB GROUP BY CB.SBDI
ORDER BY CB.SBDI ASC
-- Q19
SELECT CB.SBDI, LB.NGAYDI, COUNT(LB.NGAYDI) AS SOLUONGXUATPHAT
FROM dbo.LICHBAY LB, dbo.CHUYENBAY CB WHERE LB.MACB = CB.MACB
GROUP BY CB.SBDI, LB.NGAYDI
-- Q20
SELECT CB.SBDEN, LB.NGAYDI, COUNT(LB.NGAYDI) AS SOLUONGHACANH
FROM dbo.LICHBAY LB, dbo.CHUYENBAY CB WHERE LB.MACB = CB.MACB
GROUP BY CB.SBDEN, LB.NGAYDI
-- Q21
SELECT PC.MACB, PC.NGAYDI, COUNT(NV.MANV) AS SOLUONGNHANVIENKHONGLAPHICONG
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV AND NV.LOAINV = 0
GROUP BY PC.MACB, PC.NGAYDI
-- Q22
SELECT COUNT(LB.MACB) AS SOCHUYENBAYXUATPHAT
FROM dbo.LICHBAY LB, dbo.CHUYENBAY CB WHERE LB.MACB = CB.MACB AND CB.SBDI = 'MIA' AND DATEDIFF(DAY, LB.NGAYDI, '11/01/2000') = 0
-- Q23
SELECT PC.MACB, PC.NGAYDI, COUNT(NV.MANV) AS SONHANVIENDUOCPHANCONG
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV
GROUP BY PC.MACB, PC.NGAYDI
ORDER BY SONHANVIENDUOCPHANCONG DESC
-- Q24
SELECT DC.MACB, DC.NGAYDI, COUNT(DC.MAKH) AS SOLUONGKHACHHANGDATCHO
FROM dbo.DATCHO DC
GROUP BY DC.MACB, DC.NGAYDI 
ORDER BY SOLUONGKHACHHANGDATCHO DESC
-- Q25
SELECT PC.MACB, PC.NGAYDI, SUM(NV.LUONG) AS TONGLUONGPHIHANHDOAN
FROM dbo.PHANCONG PC, dbo.NHANVIEN NV WHERE PC.MANV = NV.MANV 
GROUP BY PC.MACB, PC.NGAYDI
ORDER BY TONGLUONGPHIHANHDOAN ASC
-- Q26
SELECT AVG(NV.LUONG) AS LUONGTBKHONGLAPHICONG FROM dbo.NHANVIEN NV WHERE NV.LOAINV = 0
-- Q27
SELECT AVG(NV.LUONG) AS LUONGTBLAPHICONG FROM dbo.NHANVIEN NV WHERE NV.LOAINV = 1
-- Q28
SELECT LB.MALOAI, COUNT(LB.NGAYDI) AS SOLUONGHACANH
FROM dbo.LICHBAY LB, dbo.CHUYENBAY CB WHERE LB.MACB = CB.MACB AND CB.SBDEN = 'ORD'
GROUP BY LB.MALOAI
-- Q29
SELECT CB.SBDI, COUNT(CB.MACB) AS SOLUONGCHUYENBAY
FROM dbo.CHUYENBAY CB WHERE DATEDIFF(MINUTE, CB.GIODI, '10:00') <= 0 AND DATEDIFF(MINUTE, CB.GIODI, '22:00') >= 0
GROUP BY CB.SBDI HAVING COUNT(CB.MACB) > 2
-- Q30
SELECT NV.TEN
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV AND NV.LOAINV = 1 
GROUP BY NV.TEN
HAVING COUNT(PC.NGAYDI) >= 2
-- Q31
SELECT DC.MACB, DC.NGAYDI 
FROM dbo.DATCHO DC 
GROUP BY DC.MACB, DC.NGAYDI
HAVING COUNT(DC.MAKH) < 3
-- Q32
SELECT LB.SOHIEU, LB.MALOAI
FROM dbo.LICHBAY LB, dbo.PHANCONG PC WHERE PC.MACB = LB.MACB AND PC.MANV = '1001' AND PC.NGAYDI = LB.NGAYDI
GROUP BY LB.SOHIEU, LB.MALOAI
HAVING COUNT(PC.NGAYDI) > 2
-- Q33
SELECT LM.HANGSX, COUNT(LM.MALOAI) AS SOLUONGSANXUAT
FROM dbo.LOAIMB LM GROUP BY LM.HANGSX
-- Q34
SELECT LM.HANGSX, LM.MALOAI, LB.SOHIEU
FROM dbo.LOAIMB LM, dbo.LICHBAY LB WHERE LM.MALOAI = LB.MALOAI
GROUP BY LM.HANGSX, LM.MALOAI, LB.SOHIEU
HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM dbo.LOAIMB LM, dbo.LICHBAY LB WHERE LM.MALOAI = LB.MALOAI GROUP BY LM.HANGSX, LM.MALOAI, LB.SOHIEU)
-- Q35
SELECT NV.TEN
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV
GROUP BY NV.TEN
HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV GROUP BY NV.TEN)
-- Q36
SELECT NV.TEN, NV.DCHI, NV.DTHOAI
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV AND NV.LOAINV = 1
GROUP BY NV.TEN, NV.DCHI, NV.DTHOAI
HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV AND NV.LOAINV = 1 GROUP BY NV.TEN, NV.DCHI, NV.DTHOAI)
-- Q37
SELECT CB.SBDEN, COUNT(CB.MACB) AS SOLUONGCHUYENBAY
FROM dbo.CHUYENBAY CB
GROUP BY CB.SBDEN
HAVING COUNT(*) <= ALL (SELECT COUNT(*) FROM dbo.CHUYENBAY CB GROUP BY CB.SBDEN)
-- Q38
SELECT CB.SBDI, COUNT(CB.MACB) AS SOLUONGCHUYENBAY
FROM dbo.CHUYENBAY CB
GROUP BY CB.SBDI
HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM dbo.CHUYENBAY CB GROUP BY CB.SBDI)
-- Q39
SELECT KH.TEN, KH.DCHI, KH.DTHOAI
FROM dbo.KHACHHANG KH, dbo.DATCHO DC WHERE KH.MAKH = DC.MAKH
GROUP BY KH.TEN, KH.DCHI, KH.DTHOAI
HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM dbo.KHACHHANG KH, dbo.DATCHO DC WHERE KH.MAKH = DC.MAKH GROUP BY KH.TEN, KH.DCHI, KH.DTHOAI)
-- Q40
SELECT NV.MANV, NV.TEN, NV.LUONG
FROM dbo.NHANVIEN NV, dbo.KHANANG KN WHERE NV.MANV = KN.MANV AND NV.LOAINV = 1
GROUP BY NV.MANV, NV.TEN, NV.LUONG
HAVING COUNT(*) >= ALL (SELECT COUNT(*) FROM dbo.NHANVIEN NV, dbo.KHANANG KN WHERE NV.MANV = KN.MANV AND NV.LOAINV = 1 GROUP BY NV.MANV, NV.TEN, NV.LUONG)
-- Q41
SELECT NV.MANV, NV.TEN, NV.LUONG
FROM dbo.NHANVIEN NV WHERE NV.LUONG = (SELECT MAX(NV.LUONG) FROM dbo.NHANVIEN NV)
-- Q42
SELECT DISTINCT NV.TEN, NV.DCHI
FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV AND NV.LUONG = (SELECT MAX(NV.LUONG) FROM dbo.NHANVIEN NV, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV)
-- Q43
SELECT CB.MACB, CB.GIODI, CB.GIODEN
FROM dbo.CHUYENBAY CB WHERE DATEDIFF(MINUTE, CB.GIODI, (SELECT MIN(CB1.GIODI) FROM dbo.CHUYENBAY CB1)) = 0 
-- Q44
SELECT CB.MACB, CAST(DATEADD(MINUTE, DATEDIFF(MINUTE, CB.GIODI, CB.GIODEN), 0) AS TIME) AS THOIGIANBAY FROM dbo.CHUYENBAY CB 
WHERE DATEDIFF(MINUTE, DATEDIFF(MINUTE, CB.GIODI, CB.GIODEN), (SELECT MAX(DATEDIFF(MINUTE, CB.GIODI, CB.GIODEN)) FROM dbo.CHUYENBAY CB)) = 0
-- Q45
SELECT CB.MACB, CAST(DATEADD(MINUTE, DATEDIFF(MINUTE, CB.GIODI, CB.GIODEN), 0) AS TIME) AS THOIGIANBAY FROM dbo.CHUYENBAY CB
WHERE DATEDIFF(MINUTE, DATEDIFF(MINUTE, CB.GIODI, CB.GIODEN), (SELECT MIN(DATEDIFF(MINUTE, CB.GIODI, CB.GIODEN)) FROM dbo.CHUYENBAY CB)) = 0
-- Q46
SELECT LB.MACB, LB.NGAYDI FROM dbo.LICHBAY LB 
WHERE LB.MACB = (SELECT LB.MACB FROM dbo.LICHBAY LB WHERE LB.MALOAI = 'B747' GROUP BY LB.MACB 
HAVING COUNT(LB.NGAYDI) >= ALL (SELECT COUNT(LB.NGAYDI) FROM dbo.LICHBAY LB WHERE LB.MALOAI = 'B747' GROUP BY LB.MACB))
-- Q47
SELECT PC.MACB, PC.NGAYDI, COUNT(PC.MANV) AS SOLUONGNHANVIEN
FROM dbo.PHANCONG PC, (SELECT DC.MACB, DC.NGAYDI FROM dbo.DATCHO DC GROUP BY DC.MACB, DC.NGAYDI HAVING COUNT(DC.MAKH) > 3) AS DC
WHERE PC.MACB = DC.MACB AND PC.NGAYDI = DC.NGAYDI 
GROUP BY PC.MACB, PC.NGAYDI
-- Q48
SELECT NV.LOAINV, COUNT(NV.MANV) FROM dbo.NHANVIEN NV GROUP BY NV.LOAINV HAVING SUM(NV.LUONG) > 600000
-- Q49
SELECT DC.MACB, DC.NGAYDI, COUNT(DC.MAKH) AS SOLUONGKHACHHANGDATCHO
FROM dbo.DATCHO DC, (SELECT PC.MACB, PC.NGAYDI FROM dbo.PHANCONG PC GROUP BY PC.MACB, PC.NGAYDI HAVING COUNT(PC.MANV) > 3) AS PC
WHERE DC.MACB = PC.MACB AND DC.NGAYDI = PC.NGAYDI
GROUP BY DC.MACB, DC.NGAYDI
-- Q50
SELECT LB.MALOAI, COUNT(LB.SOHIEU) AS SOLUONGCHUYENBAY
FROM dbo.LICHBAY LB, (SELECT MB.MALOAI FROM dbo.MAYBAY MB GROUP BY MB.MALOAI HAVING COUNT(MB.SOHIEU) > 1) AS MB
WHERE LB.MALOAI = MB.MALOAI
GROUP BY LB.MALOAI
-- Q51
-- NOT EXISTS
SELECT CB.MACB
FROM dbo.CHUYENBAY CB 
WHERE NOT EXISTS (SELECT * FROM dbo.MAYBAY MB, dbo.LOAIMB LM WHERE MB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Boeing'
AND NOT EXISTS (SELECT * FROM dbo.LICHBAY LB WHERE LB.MACB = CB.MACB AND MB.SOHIEU = LB.SOHIEU))
-- EXCEPT 
SELECT CB.MACB
FROM dbo.CHUYENBAY CB
WHERE NOT EXISTS (SELECT CB.MACB FROM dbo.MAYBAY MB, dbo.LOAIMB LM WHERE MB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Boeing'
EXCEPT (SELECT LB.SOHIEU FROM dbo.LICHBAY LB WHERE LB.MACB = CB.MACB))
-- COUNT
SELECT CB.MACB
FROM dbo.CHUYENBAY CB, dbo.MAYBAY MB, dbo.LOAIMB LM, dbo.LICHBAY LB 
WHERE CB.MACB = LB.MACB AND LB.SOHIEU = MB.SOHIEU AND MB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Boeing'
GROUP BY CB.MACB
HAVING COUNT(MB.SOHIEU) = (SELECT COUNT(*) FROM dbo.MAYBAY MB, dbo.LOAIMB LM WHERE MB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Boeing')
-- Q52
-- NOT EXISTS
SELECT NV.MANV, NV.TEN
FROM dbo.NHANVIEN NV WHERE NOT EXISTS (SELECT * FROM dbo.MAYBAY MB, dbo.LOAIMB LM WHERE MB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Airbus'
AND NOT EXISTS (SELECT * FROM dbo.KHANANG KN WHERE KN.MANV = NV.MANV AND KN.MALOAI = LM.MALOAI))
-- EXCEPT
SELECT NV.MANV, NV.TEN
FROM dbo.NHANVIEN NV WHERE NOT EXISTS (SELECT MB.MALOAI FROM dbo.MAYBAY MB, dbo.LOAIMB LM WHERE MB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Airbus'
EXCEPT (SELECT KN.MALOAI FROM dbo.KHANANG KN WHERE KN.MANV = NV.MANV))
-- COUNT
SELECT NV.MANV, NV.TEN
FROM dbo.NHANVIEN NV, dbo.MAYBAY MB, dbo.LOAIMB LM, dbo.KHANANG KN
WHERE NV.MANV = KN.MANV AND MB.MALOAI = LM.MALOAI AND KN.MALOAI = MB.MALOAI AND LM.HANGSX = 'Airbus'
GROUP BY NV.MANV, NV.TEN
HAVING COUNT(KN.MALOAI) = (SELECT COUNT(*) FROM dbo.MAYBAY MB, dbo.LOAIMB LM WHERE MB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Airbus')
-- Q53
-- NOT EXISTS
SELECT NV.TEN
FROM dbo.NHANVIEN NV WHERE NV.LOAINV = 0 AND NOT EXISTS (SELECT * FROM dbo.CHUYENBAY CB WHERE CB.MACB = '100'
AND NOT EXISTS (SELECT * FROM dbo.PHANCONG PC WHERE PC.MANV = NV.MANV AND PC.MACB = CB.MACB))
-- EXCEPT
SELECT NV.TEN
FROM dbo.NHANVIEN NV WHERE NV.LOAINV = 0 AND NOT EXISTS (SELECT CB.MACB FROM dbo.CHUYENBAY CB WHERE CB.MACB = '100'
EXCEPT (SELECT PC.MACB FROM dbo.PHANCONG PC WHERE PC.MANV = NV.MANV))
-- COUNT
SELECT NV.TEN
FROM dbo.NHANVIEN NV, dbo.CHUYENBAY CB, dbo.PHANCONG PC WHERE NV.MANV = PC.MANV AND CB.MACB = PC.MACB AND NV.LOAINV = 0 AND CB.MACB = '100'
GROUP BY NV.TEN
HAVING COUNT(CB.MACB) = (SELECT COUNT(*) FROM dbo.CHUYENBAY CB WHERE CB.MACB = '100')
-- Q54
-- NOT EXISTS
SELECT LB.NGAYDI, LB.MACB
FROM dbo.LICHBAY LB WHERE NOT EXISTS (SELECT * FROM dbo.LOAIMB LM, dbo.MAYBAY MB WHERE LM.MALOAI = MB.MALOAI AND LM.HANGSX = 'Boeing'
AND NOT EXISTS (SELECT * FROM dbo.LICHBAY LB1 WHERE LB1.MACB = LB.MACB AND LB1.SOHIEU = MB.SOHIEU))
-- EXCEPT
SELECT LB.NGAYDI, LB.MACB
FROM dbo.LICHBAY LB WHERE NOT EXISTS (SELECT MB.SOHIEU FROM dbo.LOAIMB LM, dbo.MAYBAY MB WHERE LM.MALOAI = MB.MALOAI AND LM.HANGSX = 'Boeing'
EXCEPT (SELECT LB.SOHIEU FROM dbo.LICHBAY LB1 WHERE LB1.MACB = LB.MACB))
-- COUNT
SELECT LB.NGAYDI, LB.MACB
FROM dbo.LICHBAY LB, dbo.MAYBAY MB, dbo.LOAIMB LM WHERE LM.MALOAI = MB.MALOAI AND MB.SOHIEU = LB.SOHIEU AND LM.HANGSX = 'Boeing'
GROUP BY LB.NGAYDI, LB.MACB
HAVING COUNT(LB.MALOAI) = (SELECT COUNT(*) FROM dbo.MAYBAY MB, dbo.LOAIMB LM WHERE MB.MALOAI = LM.MALOAI AND LM.HANGSX = 'Boeing')